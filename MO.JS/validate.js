  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js?v=1')
      .then(() => console.log("โ ุชู ุชูุนูู ุงูู PWA"))
      .catch(err => console.log("โ ุฎุทุฃ ูู SW:", err));
  }
  
  if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js').then(reg => {
    reg.onupdatefound = () => {
      const newWorker = reg.installing;
      newWorker.onstatechange = () => {
        if (newWorker.state === 'installed') {
          if (navigator.serviceWorker.controller) {
            let reload = confirm("โก ุชู ุฅุตุฏุงุฑ ูุณุฎุฉ ุฌุฏูุฏุฉุ ูู ุชุฑูุฏ ุงูุชุญุฏูุซ ุงูุขูุ");
            if (reload) {
              window.location.reload();
            }
          }
        }
      };
    };
  });
}
  function preventTouchScroll(e) {
    e.preventDefault();
  }

  function openFormPopup() {
    document.getElementById("formPopup").style.display = "block";
    document.getElementById("overlay").style.display = "block";

    // โ ููุน ุณุญุจ ุงูุดุงุดุฉ ุจุงูููุณ
    document.body.style.overflow = "hidden";
    document.body.addEventListener('touchmove', preventTouchScroll, { passive: false });
  }

  function closeFormPopup() {
    document.getElementById("formPopup").style.display = "none";
    document.getElementById("overlay").style.display = "none";

    // โ ุฅุฑุฌุงุน ุงูุชูุฑูุฑ ุจุงูููุณ
    document.body.style.overflow = "";
    document.body.removeEventListener('touchmove', preventTouchScroll);
  }

  let deferredPrompt;
  const installBtn = document.getElementById('installBtn');

  window.addEventListener('beforeinstallprompt', (e) => {
    // ููุน ุธููุฑ ุงูุจูุจ ุฃุจ ุงูุชููุงุฆู
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = 'inline-block'; // ุฃุธูุฑ ุงูุฒุฑ
  });

  installBtn.addEventListener('click', async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt(); // ุฅุธูุงุฑ ูุงูุฐุฉ ุงูุชุซุจูุช
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        console.log('โ ุงููุณุชุฎุฏู ูุงูู ุนูู ุงูุชุซุจูุช');
        installBtn.style.display = 'none';
      } else {
        console.log('โ ุงููุณุชุฎุฏู ุฑูุถ ุงูุชุซุจูุช');
      }
      deferredPrompt = null;
    }
  });

document.addEventListener("DOMContentLoaded", function () {
  // ุงุณุชูุฏุงู ูู ุงูููุฏูููุงุช ุฏุงุฎู .video-grid
  const videos = document.querySelectorAll('.video-grid video');

  videos.forEach(video => {
    // ๐ ุนูุฏ ุงูุถุบุท ุนูู ุงูููุฏูู: ุชุดุบูู/ุฅููุงู
    video.addEventListener('click', function (e) {
      e.preventDefault(); // ููู ุนูุดุงู ูููุน ุงูุชูุงุนู ุงูุชููุงุฆู
      if (this.paused) {
        this.play();
      } else {
        this.pause();
      }
    });

    // ๐ ุนูุฏ ุชุดุบูู ููุฏูู: ุฅููุงู ุงูุจุงูู
    video.addEventListener('play', () => {
      videos.forEach(other => {
        if (other !== video && !other.paused) {
          other.pause();
        }
      });
    });
  });

  // ๐ ุฅููุงู ุงูููุฏูููุงุช ุงููู ุฎุฑุฌุช ูู ุงูุดุงุดุฉ
  function handleScrollPause() {
    videos.forEach(video => {
      const rect = video.getBoundingClientRect();
      const isVisible = rect.top >= 0 && rect.bottom <= window.innerHeight;

      if (!isVisible && !video.paused) {
        video.pause();
      }
    });
  }

  window.addEventListener('scroll', handleScrollPause);
  window.addEventListener('load', handleScrollPause);
});

  // ---------------------- โ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (menu) ----------------------
  const menuToggle = document.getElementById("menuToggle");
  const navLinks = document.getElementById("navLinks");

  // ูุชุญ/ุบูู ุงููููู
  menuToggle.addEventListener("click", () => {
    navLinks.classList.toggle("active");
  });

  // ุบูู ุงููููู ุนูุฏ ุงูุถุบุท ุนูู ุฃู ุฑุงุจุท
  document.querySelectorAll("#navLinks a").forEach(link => {
    link.addEventListener("click", () => {
      navLinks.classList.remove("active");
    });
  });

  // ---------------------- โ ุงูู ุงููู----------------------
    const verses = [
    { text: "๏ดฟ ููุฑูุชูููู ุงููููุฑูุขูู ุชูุฑูุชููููุง ๏ดพ", surah: "ุงููุฒูู: 4" },
    { text: "๏ดฟ ุฅูููู ููุนู ุงููุนูุณูุฑู ููุณูุฑูุง ๏ดพ", surah: "ุงูุดุฑุญ: 6" },
    { text: "๏ดฟ ููุงุฐูููุฑููููู ุฃูุฐูููุฑููููู ๏ดพ", surah: "ุงูุจูุฑุฉ: 152" },
    { text: "๏ดฟ ุฅูููู ุงูููููู ููุนู ุงูุตููุงุจูุฑูููู ๏ดพ", surah: "ุงูุจูุฑุฉ: 153" },
    { text: "๏ดฟ ุฅูููู ุงูููููู ุบููููุฑู ุฑูุญูููู ๏ดพ", surah: "ุงููุงุฆุฏุฉ: 74" },
    { text: "๏ดฟ ููููุง ุชููููููููู ุฅููููุง ุจูุงูููููู ๏ดพ", surah: "ููุฏ: 88" },
    { text: "๏ดฟ ุฅูููู ุฑูุจููู ููุณููููุนู ุงูุฏููุนูุงุกู ๏ดพ", surah: "ุฅุจุฑุงููู: 39" },
    // ูููู ุชุถูู ุขูุงุช ุฃูุชุฑ ููุง
  ];
  // ุงุฎุชุงุฑ ุขูุฉ ุจูุงุกู ุนูู ุงูููู
  const today = new Date().getDate();
  const verseIndex = today % verses.length;

  const dailyVerse = verses[verseIndex];

  // ุนุฑุถ ุงูุขูุฉ ูู ุงูุตูุญุฉ
  document.getElementById("verse").innerHTML = `
    ${dailyVerse.text} <br><span>${dailyVerse.surah}</span>
  `;
  // ---------------------- โ ุณูุงู ุงูููู---------------------
const questions = [
  {
    question: "ูุง ุฃูู ุขูุฉ ูุฒูุช ูู ุงููุฑุขูุ",
    choices: ["ุงููุฑูุฃู ุจูุงุณููู ุฑูุจูููู", "ุงููุญูููุฏู ููููููู ุฑูุจูู ุงููุนูุงููููููู", "ูููู ูููู ุงูููููู ุฃูุญูุฏู", "ุงููููู"]
  },
  {
    question: "ูู ุนุฏุฏ ุฃุฑูุงู ุงูุฅุณูุงูุ",
    choices: ["3", "4", "5", "6"]
  },
  {
    question: "ูุง ุงุณู ุงูุณูุฑุฉ ุงูุชู ูุง ุชุจุฏุฃ ุจุงูุจุณููุฉุ",
    choices: ["ุงูุฃููุงู", "ุงูููุซุฑ", "ุงูุชูุจุฉ", "ุงูุถุญู"]
  },
  {
    question: "ูู ูู ุงููุจู ุงูุฐู ุงุจุชูุนู ุงูุญูุชุ",
    choices: ["ููุณู", "ุฅุจุฑุงููู", "ูููุณ", "ุนูุณู"]
  },
  {
    question: "ูุง ูู ุฃุนุธู ุขูุฉ ูู ุงููุฑุขูุ",
    choices: ["ุขูุฉ ุงููุฑุณู", "ุณูุฑุฉ ุงูุฅุฎูุงุต", "ุจุฏุงูุฉ ุงูุจูุฑุฉ", "ุขูุฉ ุงูุฏูู"]
  },
  {
    question: "ูุง ุนุฏุฏ ุณูุฑ ุงููุฑุขู ุงููุฑููุ",
    choices: ["113", "114", "115", "112"]
  },
  {
    question: "ูุง ุงุณู ุฃู ุงููุจู ูุญูุฏ ๏ทบุ",
    choices: ["ุฎุฏูุฌุฉ", "ูุงุทูุฉ", "ุขููุฉ", "ุนุงุฆุดุฉ"]
  },
  {
    question: "ูุง ุงูุณูุฑุฉ ุงูุชู ุชูุณูู ููุจ ุงููุฑุขูุ",
    choices: ["ูุณ", "ุงูุฑุญูู", "ุงููุงุชุญุฉ", "ุงูููุฑ"]
  },
  {
    question: "ูู ูู ุฃูู ูู ุขูู ูู ุงูุตุจูุงูุ",
    choices: ["ุนูู ุจู ุฃุจู ุทุงูุจ", "ุนูุฑ ุจู ุงูุฎุทุงุจ", "ุนุซูุงู ุจู ุนูุงู", "ุนุจุฏ ุงูุฑุญูู ุจู ุนูู"]
  },
  {
    question: "ูุง ูู ุงููุจูุฉ ุงูุฃููู ูููุณููููุ",
    choices: ["ุงููุณุฌุฏ ุงูุญุฑุงู", "ุงููุณุฌุฏ ุงูุฃูุตู", "ุงููุณุฌุฏ ุงููุจูู", "ุงููุณุฌุฏ ุงูุนูุฑู"]
  }
];

const day = new Date().getDate();
const q = questions[day % questions.length];

const questionElement = document.getElementById("question");
questionElement.innerHTML = `
  <strong>${q.question}</strong>
  <ul>
    ${q.choices.map(choice => `<li>๐น ${choice}</li>`).join("")}
  </ul>
`;
  // ---------------------- โ ุณูุงูุฏุฑ ุงูุตูุฑ ----------------------
  let currentSlide = 0;
  const slider = document.getElementById("slider");
  const dots = document.querySelectorAll(".dot");
  const totalSlides = slider?.children.length || 0;

  function showSlide(index) {
    if (!slider) return;
    if (index < 0) index = totalSlides - 1;
    if (index >= totalSlides) index = 0;
    slider.style.transform = `translateX(-${index * 100}%)`;
    currentSlide = index;
    updateDots();
  }

  function nextSlide() {
    showSlide(currentSlide + 1);
  }

  function prevSlide() {
    showSlide(currentSlide - 1);
  }

  function goToSlide(index) {
    showSlide(index);
  }

  function updateDots() {
    dots.forEach((dot, i) => {
      dot.classList.toggle("active", i === currentSlide);
    });
  }

  showSlide(0);
  setInterval(() => {
    nextSlide();
  }, 5000); // โ Slide ุชููุงุฆู ูู 5 ุซูุงูู

  // ุฎูู ุงูุฏูุงู global ุนูุดุงู ุชููุน ูุน onclick ูู HTML
  window.nextSlide = nextSlide;
  window.prevSlide = prevSlide;
  window.goToSlide = goToSlide;

  // ---------------------- โ ูููุฐุฌ ุงูุชุณุฌูู ----------------------
  const form = document.getElementById("registerForm");
  if (form) {
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const childName = document.querySelector('input[name="child_name"]');
      const childAge = document.querySelector('input[name="child_age"]');
      const notes = document.querySelector('textarea[name="notes"]');
      const messageBox = document.getElementById("message");

      // Reset message
      messageBox.classList.remove("hidden");
      messageBox.style.color = "red";

      // ุงูุชุญูู
      if (childName.value.trim().length < 2) {
        messageBox.textContent = "โ ุงุณู ุงูุทูู ูุฌุจ ุฃู ูููู ุนูู ุงูุฃูู ุญุฑููู";
        childName.focus(); return;
      }

      if (childAge.value <= 0 || childAge.value > 10) {
        messageBox.textContent = "โ ุงูุนูุฑ ูุฌุจ ุฃู ูููู ุจูู 1 ุฅูู 10 ุณููุงุช";
        childAge.focus(); return;
      }

      messageBox.textContent = "โณ ุฌุงุฑู ุฅุฑุณุงู ุงูุจูุงูุงุช...";
      messageBox.style.color = "blue";

      const formData = new FormData(form);
      fetch("register.php", {
        method: "POST",
        body: formData
      })
        .then(res => res.text())
        .then(data => {
          messageBox.style.color = "green";
          messageBox.textContent = data;
          form.reset();
          setTimeout(() => messageBox.classList.add("hidden"), 5000);
        })
        .catch(() => {
          messageBox.style.color = "red";
          messageBox.textContent = "โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู.";
        });
    });
  }
  // ---------------------- โ ุฒุฑ ุงูุฑุฌูุน ูุฃุนูู ุงูุตูุญุฉ ----------------------

  // ---------------------- โ ุนุฑุถ ุงูุตูุฑ ุฏุงุฎู ููุฏุงู ----------------------
  window.openImage = function (src) {
    const modal = document.getElementById("imageModal");
    const img = document.getElementById("modalImage");
    if (modal && img) {
      img.src = src;
      modal.style.display = "flex";
    }
  }

  window.closeImage = function () {
    const modal = document.getElementById("imageModal");
    if (modal) modal.style.display = "none";
  }

  window.onclick = function (e) {
    const modal = document.getElementById("imageModal");
    if (e.target === modal) {
      closeImage();
    }
  }

